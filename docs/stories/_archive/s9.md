### **Story 9: "SLIP" Repair Flow**

**User Story:**
As a returning citizen, when I relapse, I want to be able to text "SLIP" to the service and receive a compassionate, non-judgmental response, so that I can safely acknowledge my situation and begin the process of repair.

**Story Context:**
*   **Existing System Integration:** This story introduces a new, parallel flow to the `ConversationEngine`, triggered by a specific keyword.
*   **Technology:** TypeScript, Drizzle ORM.
*   **Follows pattern:** Adds a new FSM flow (`repair`) to the `ConversationEngine`, distinct from the `daily` ritual flow.
*   **Touch points:**
    *   `server/services/conversationEngine.ts` will be significantly updated to handle the new flow.
    *   The `sessions` table will be used to log the new `flowType`.

**Acceptance Criteria:**
1.  The `ConversationEngine` is updated to detect the keyword "SLIP" (case-insensitive) as the very first step when processing an incoming SMS.
2.  If the "SLIP" keyword is detected, the engine initiates the "repair" flow.
3.  The engine immediately responds with a pre-defined, empathetic, and non-judgmental message (e.g., "Thank you for reaching out. It takes courage to acknowledge a slip. We're here with you. No judgment.").
4.  A new session is logged to the `sessions` table with the `flowType` correctly set to 'repair'.
5.  The user's current daily check-in streak is reset to 0. This can be done by updating the most recent session record or by ensuring the next daily check-in starts the streak at 1.
6.  For this story, the repair flow concludes after sending the initial compassionate message.

**Technical Notes:**
*   **Integration Approach:** The "SLIP" keyword check should take precedence over the daily ritual FSM logic. This will likely be a new top-level conditional in the `processInput` method.
*   **Existing Pattern Reference:** The concept of a `flowType` in the `sessions` table was designed for this purpose and should be utilized.
*   **Key Constraints:** The tone of the response message is critical and must be supportive and aligned with trauma-informed design principles.

**Definition of Done:**
*   [ ] Texting "SLIP" to the Twilio number successfully triggers the repair flow.
*   [ ] The user receives the correct compassionate response.
*   [ ] A new session with `flowType: 'repair'` is created in the database.
*   [ ] The user's streak is reset.
*   [ ] Unit tests for the "SLIP" trigger, response, and streak reset logic pass.
*   [ ] Code has been reviewed and approved by the Architect.

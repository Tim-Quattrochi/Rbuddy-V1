### **Story 4: Daily Ritual FSM (Part 2 - Affirmation & Intention)**

**User Story:**
As a returning citizen, after I share my mood, I want to receive an affirmation and be given the option to set an intention for the day, so that I can complete my check-in ritual.

**Story Context:**
*   **Existing System Integration:** This story directly extends the `ConversationEngine` FSM created in the previous story.
*   **Technology:** TypeScript.
*   **Follows pattern:** Continues the implementation of the custom FSM within the `ConversationEngine`.
*   **Touch points:**
    *   The `server/services/conversationEngine.ts` file will be modified to include the new FSM steps.

**Acceptance Criteria:**
1.  After a valid mood is received, the `ConversationEngine` immediately sends a relevant affirmation message to the user.
2.  Following the affirmation, the engine prompts the user if they would like to set an intention for the day (e.g., "Would you like to set an intention for today? Reply YES or NO.").
3.  The engine correctly parses the user's "YES" or "NO" response (case-insensitive).
4.  If the user replies "YES", the engine prompts them to send their intention, and their next message is captured and stored in the `ConversationState`.
5.  If the user replies "NO", the flow proceeds to the completion step.
6.  Upon completion of the flow (with or without an intention), the engine sends a concluding message (e.g., "Your check-in is complete. Thank you.").
7.  The `ConversationState` is updated to track the user's current step in the flow (e.g., `affirmation`, `intention_prompt`, `intention_capture`).

**Technical Notes:**
*   **Integration Approach:** This work involves adding new states and transitions to the FSM logic within the `ConversationEngine.processInput()` method.
*   **Existing Pattern Reference:** The new logic should follow the stateful, step-by-step processing pattern established in the previous story.
*   **Key Constraints:** The conversation flow must feel natural and guide the user clearly from one step to the next.

**Definition of Done:**
*   [ ] The `ConversationEngine` can successfully guide a user through the entire daily ritual flow, from mood prompt to completion.
*   [ ] Both the "YES" and "NO" paths for the intention-setting step are fully functional.
*   [ ] Unit tests for the affirmation and intention-handling logic pass.
*   [ ] Code has been reviewed and approved by the Architect.

# Story 3.1: Fix End-to-End Daily Ritual Persistence

### Status
Draft

### Story
As an authenticated user, I want to successfully complete my daily ritual, have my data saved, and see my streak update, so that the core check-in feature is fully functional.

### Acceptance Criteria
1. When an authenticated user loads the `/daily-ritual` page, the API call to `GET /api/user/stats` succeeds, and their correct streak count is displayed.
2. When the user clicks a mood button, the `POST /api/daily-ritual/mood` call succeeds, and the corresponding affirmation is displayed.
3. A new `sessions` record is created in the database for the user's check-in.
4. When the user submits an optional intention, the `POST /api/daily-ritual/intention` call succeeds, and the `sessions` record is updated.
5. All API calls made from the `DailyRitual.tsx` page must be authenticated using the JWT provided by the global `useAuth` hook.
6. The page correctly handles and displays loading states while fetching data and submitting mutations.
7. User-facing error messages are displayed if an API call fails.

### Tasks / Subtasks
- [ ] **Task 1: Backend Verification**
    - [ ] Review and verify that the backend logic for the `/api/user/stats`, `/api/daily-ritual/mood`, and `/api/daily-ritual/intention` endpoints is complete and correctly interacts with the database.
- [ ] **Task 2: Frontend Refactoring**
    - [ ] In `client/src/pages/DailyRitual.tsx`, remove the hardcoded placeholder `AUTH_TOKEN`.
    - [ ] Integrate the `useAuth` hook to get the real user session token.
    - [ ] Update all `fetch` calls to include the real token in the Authorization header.
    - [ ] Implement robust loading and error states for the UI based on the status of the TanStack Query hooks.
- [ ] **Task 3: E2E Testing**
    - [ ] Write an end-to-end test that simulates a user logging in, completing a ritual, and verifying that the streak count updates on a subsequent page load.

### Dev Notes
* This story addresses the core bugs reported by the user. The primary cause of the current errors is the placeholder token being used on the frontend.
* The main focus is to connect the frontend `DailyRitual.tsx` page to the backend using the proper authentication state that will be provided by the work in Epic 1.

---
### Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-11 | 1.0 | Initial story creation. | Scrum Master |